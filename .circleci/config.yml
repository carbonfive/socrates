version: 2.1
orbs:
  ruby: circleci/ruby@1.2.0
jobs:
  build:
    parallelism: 1
    working_directory: ~/socrates
    docker:
      - image: cimg/ruby:3.0.2
    steps:
      - checkout
      - run:
          command: |
            gem install bundler
            bundle config set path .vendor/bundle
            bundle install --jobs=4 && bundle clean --force
      - ruby/rubocop-check
      - ruby/rspec-test
      - store_artifacts: # Save the test logs for debugging
          path: ./log/test.log
          destination: test.log
